/*! ng-w5c-validator v2.5.4 2017-06-15 */
!function(){var a=angular.module("w5c.validator",["ng"]).provider("w5cValidator",[function(){var a={required:"该选项不能为空",maxlength:"该选项输入值长度不能大于{maxlength}",minlength:"该选项输入值长度不能小于{minlength}",email:"输入邮件的格式不正确",repeat:"两次输入不一致",pattern:"该选项输入格式不正确",number:"必须输入数字",w5cuniquecheck:"该输入值已经存在，请重新输入",url:"输入URL格式不正确",max:"该选项输入值不能大于{max}",min:"该选项输入值不能小于{min}",customizer:"自定义验证不通过"},b=["text","password","email","number","url","tel","hidden",["textarea"],["select"],["select-multiple"],["select-one"],"radio","checkbox"],c=function(a){return"FORM"===a[0].tagName||11==a[0].nodeType?null:a&&a.hasClass("form-group")?a:c(a.parent())},d=function(){this.elemTypes=b,this.rules={},this.isEmpty=function(a){return a?a instanceof Array&&0===a.length?!0:!1:!0},this.defaultShowError=function(a,b){var d=angular.element(a),e=c(d);this.isEmpty(e)||e.hasClass("has-error")||e.addClass("has-error");var f=d.next();f&&f.hasClass("w5c-error")||d.after('<span class="w5c-error">'+b[0]+"</span>")},this.defaultRemoveError=function(a){var b=angular.element(a),d=c(b);!this.isEmpty(d)&&d.hasClass("has-error")&&d.removeClass("has-error");var e=b.next();e.hasClass&&e.hasClass("w5c-error")&&e.remove()},this.options={blurTrig:!1,showError:!0,removeError:!0}};d.prototype={constructor:d,config:function(a){this.options=angular.extend(this.options,a)},setRules:function(a){this.rules=angular.extend(this.rules,a)},getErrorMessage:function(b,c){var d=null,e=c.name;switch(e&&/\$\d+\$/i.test(e)&&(e=e.replace(/\$\d+\$/i,"")),this.isEmpty(this.rules[e])||this.isEmpty(this.rules[e][b])||(d=this.rules[e][b]),b){case"maxlength":return(d||a.maxlength).replace("{maxlength}",c.getAttribute("ng-maxlength"));case"minlength":return(d||a.minlength).replace("{minlength}",c.getAttribute("ng-minlength"));case"max":return(d||a.max).replace("{max}",c.getAttribute("max"));case"min":return(d||a.min).replace("{min}",c.getAttribute("min"));default:if(null!==d)return d;if(null===a[b])throw new Error("该验证规则("+b+")默认错误信息没有设置！");return a[b]}},getErrorMessages:function(a,b){var c=[];for(var d in b)if(b[d]){var e=this.getErrorMessage(d,a);c.push(e)}return c},showError:function(a,b,c){var d=angular.extend({},this.options,c);return angular.element(a).removeClass("valid").addClass("error"),d.showError!==!1?angular.isFunction(d.showError)?d.showError(a,b):d.showError===!0?this.defaultShowError(a,b):void 0:void 0},removeError:function(a,b){var c=angular.extend({},this.options,b);return angular.element(a).removeClass("error").addClass("valid"),c.removeError!==!1?angular.isFunction(c.removeError)?c.removeError(a):c.removeError===!0?this.defaultRemoveError(a):void 0:void 0}};var e=new d;this.config=function(a){e.config(a)},this.setRules=function(a){e.setRules(a)},this.setDefaultRules=function(b){a=angular.extend(a,b)},this.$get=function(){return e}}]);"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports=a.name)}(),function(){function a(a,b,c,d,e,f){var g=this,h=b[0];this.needBindKeydown=!1,this.formCtrl=null,this.submitSuccessFn=null,this.validElements=[],this.setElementErrorMessage=function(a,b){var c=this,e=h[a];a&&c.validElements.indexOf(a)>=0&&(d.removeError(e,c.options),d.showError(e,[b],c.options))},this.validateFormElement=function(a){var b=this,c=h[a];if(a&&b.validElements.indexOf(a)>=0&&b.formCtrl[a]&&c&&d.elemTypes.toString().indexOf(c.type)>-1&&!d.isEmpty(a)){if(!b.formCtrl[a].$valid){var e=d.getErrorMessages(c,b.formCtrl[c.name].$error);return d.removeError(c,b.options),d.showError(c,e,b.options),b.formCtrl[a].w5cError=!0,e}d.removeError(c,b.options),b.formCtrl[a].w5cError=!1}return null},this.validateForm=function(){for(var b=this,c=this.formCtrl,e=[],f=0;f<h.elements.length;f++){var g=b.validateFormElement(h.elements[f].name);g&&g.length>=1&&e.push(g[0])}!d.isEmpty(e)&&e.length>0?c.$errors=e:c.$errors=[],a.$$phase||a.$apply(c.$errors)},this.setValidate=function(i){this.formCtrl=i;var j=i.doValidate=this.validateForm.bind(this);i.validateElement=this.validateFormElement.bind(this),i.setElementErrorMessage=this.setElementErrorMessage.bind(this),i.reset=function(){f(function(){i.$setPristine();for(var a=0;a<h.elements.length;a++){var b=h.elements[a],c=angular.element(b);d.removeError(c,g.options)}i.$errors=[]})};var k=e(c.w5cSubmit);c.w5cSubmit&&angular.isFunction(k)&&(b.bind("submit",function(b){j(),i.$valid&&angular.isFunction(k)&&a.$apply(function(){k(a,{$event:b})})}),this.needBindKeydown=!0),this.needBindKeydown&&b.bind("keydown keypress",function(c){if(13===c.which){var d=document.activeElement;if(d.type&&"textarea"!==d.type){var e=b.find("button");e&&e[0]&&e[0].focus(),d.focus(),j(),c.preventDefault(),i.$valid&&angular.isFunction(g.submitSuccessFn)&&a.$apply(function(){g.submitSuccessFn(a,{$event:c})})}}})},this.doValidate=function(b,c){var d=this;if(angular.isFunction(d.formCtrl.doValidate)&&d.formCtrl.doValidate(),d.formCtrl.$valid&&angular.isFunction(b))a.$apply(function(){b()});else if(!d.formCtrl.$valid&&angular.isFunction(c)){var e=d._getInvalidElements();a.$apply(function(){c(d.formCtrl.$errors,e)})}},this._getInvalidElements=function(){for(var a=[],c=0;c<b[0].elements.length;c++){var d=b[0].elements[c];this.validElements.indexOf(d.name)>=0&&this.formCtrl[d.name]&&this.formCtrl[d.name].$invalid&&a.push(d)}return a},this.removeElementValidation=function(a){var b=this.validElements.indexOf(a);b>=0&&(this.validElements.splice(b,1),d.isEmpty(this.formCtrl.$errors)||this.doValidate(angular.noop))},this.removeError=function(a){this.formCtrl.$errors=[],this.formCtrl[a[0].name]&&(this.formCtrl[a[0].name].w5cError=!1),d.removeError(a,this.options)},this.initElement=function(b){var c=angular.element(b),e=this;if(d.elemTypes.toString().indexOf(b.type)>-1&&!d.isEmpty(b.name)&&!/^\d/.test(b.name)){var g=c.attr("disabled");if(g&&("true"===g||"disabled"===g))return;if(!(this.validElements.indexOf(b.name)<0))return;this.validElements.push(b.name);var h=this.formName+"."+b.name+".$viewValue";a.$watch(h,function(){e.removeError(c)},!0),e.options&&e.options.blurTrig&&c.bind("blur",function(){if(e.options.blurTrig){var a=this;f(function(){e.validateFormElement(a.name)},50)}})}},this._init=function(){if(this.formName=b.attr("name"),!this.formName)throw Error("form must has name when use w5cFormValidate");var e=a.$eval(c.w5cFormValidate);c.w5cFormValidate&&a.$watch(c.w5cFormValidate,function(a){a&&(g.options=e=angular.extend({},d.options,a))},!0),this.options=angular.extend({},d.options,e);for(var f=0;f<b[0].elements.length;f++)this.initElement(b[0].elements[f])},this._init()}angular.module("w5c.validator").directive("w5cFormValidate",[function(){return{require:["w5cFormValidate","^?form"],controller:["$scope","$element","$attrs","w5cValidator","$parse","$timeout",a],link:function(a,b,c,d){var e=d[0],f=d[1];e.setValidate(f)}}}]).directive("w5cFormSubmit",["$parse",function(a){return{require:"^w5cFormValidate",link:function(b,c,d,e){var f=a(d.w5cFormSubmit),g=a(d.errorCallback);c.bind("click",function(a){e.doValidate(function(){f(b,{$event:a})},function(c,d){g&&g(b,{$event:a,$errors:c,$invalidElements:d})})}),e.needBindKeydown=!0,e.submitSuccessFn=b.w5cFormSubmit}}}]).directive("w5cRepeat",["$timeout",function(a){"use strict";return{require:["ngModel","^w5cFormValidate"],link:function(b,c,d,e){a(function(){var a=c.inheritedData("$formController")[d.w5cRepeat],b=e[0],f=e[1];b.$parsers.push(function(c){return c===a.$modelValue?b.$setValidity("repeat",!0):b.$setValidity("repeat",!1),c}),a.$parsers.push(function(a){return b.$setValidity("repeat",a===b.$modelValue),a===b.$modelValue&&f.removeError(c),a})})}}}]).directive("w5cCustomizer",["$timeout",function(a){"use strict";return{require:["^form","?ngModel"],link:function(a,b,c,d){var e=d[1],f=function(){var b=a.$eval(c.w5cCustomizer);b===!0?e.$setValidity("customizer",!0):e.$setValidity("customizer",!1)},g=d[0][c.associate];g&&g.$viewChangeListeners.push(f),e.$viewChangeListeners.push(f),f()}}}]).directive("w5cUniqueCheck",["$timeout","$http","w5cValidator",function(a,b,c){return{require:["ngModel","?^w5cFormValidate","?^form"],link:function(a,d,e,f){var g=f[0],h=f[1],i=f[2],j=function(){var f=a.$eval(e.w5cUniqueCheck),j=f.url,k=f.isExists;b.get(j).success(function(a){var b=k===!1?"true"==a||1==a:!("true"==a||1==a);if(g.$setValidity("w5cuniquecheck",b),!b){var e=c.getErrorMessage("w5cuniquecheck",d[0]);c.showError(d[0],[e],h.options),i[d[0].name]&&(i[d[0].name].w5cError=!0),i.$errors?i.$errors.unshift(e):i.$errors=[e]}})};g.$viewChangeListeners.push(function(){i.$errors=[],g.$setValidity("w5cuniquecheck",!0),(!g.$invalid||g.$error.w5cuniquecheck)&&g.$dirty&&j()});var k=a.$eval(e.ngModel);if(k){if(g.$invalid&&!g.$error.w5cuniquecheck)return;j()}}}}]).directive("w5cDynamicName",[function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){var e=a.$eval(c.w5cDynamicName)||c.w5cDynamicName;if(e){d.$name=e,b.attr("name",e);var f=b.controller("form")||{$addControl:angular.noop};f.$addControl(d)}}}}]).directive("w5cDynamicElement",["$timeout",function(a){return{restrict:"A",require:["?ngModel","?^w5cFormValidate","?^form"],link:function(b,c,d,e){var f=c[0].name,g=e[2];if(f){c.on("$destroy",function(a){b[g.$name]&&e[1].removeElementValidation(f)}),g[f]||g.$addControl(e[0]);var h=!1;e[2].$errors&&e[2].$errors.length>0&&(h=!0),e[1].initElement(c[0]),h&&a(function(){e[1].doValidate(angular.noop)})}}}}])}();